# APE and Gateway Records Simulator
<br>

# Description:

The APE and Gateway Records Simulator is a standalone program to simulate the movement of tags in a space and the reserve sensor records generated by gateways.

# Configuration:

The simulator program is a separate, standalone Node.js program, but it uses the config.js file, the dbConnections.js file, and all of the necessary database model files from the parent repo.
<br>
<br>

# How To Run:

To run the APE records simulator, ensure that you already have a "activenodes" collection with valid entries and some valid records in the "gatewayrecords" collection (because of poor design of the simulator), then open up a terminal at the program's directory and run the following command:

* node apeDataSimulator.js

# Database Collection Configuration

The simulator saves all of its data to the following collections on the "agtsDbServer", as described in the Web API's Readme.md file:

* activenodes
* ape_record
* gatewayrecords
* objects

<br>
<br>

# Database Naming Convention:
``` JSON
| Database              | Name                     | Variable Format                    |
|-----------------------|--------------------------|------------------------------------|
| APE Records           | data_loc_<SCENARIO_ID>*  | Integer, n != 0                    |
```
Where "SCENARIO_ID" is any integer greater than 0
<br>
<br>

# Data Rates:
``` JSON
|                   | Test                 | Prod                  |
|-------------------|----------------------|-----------------------|
| APE Records       | 600 records / min    | 600 records / min     |
| Gateway Records   | 120 records / min    | 120 records / min     |
```
<br>
<br>

# Data Cleanup Frequency:

All real and simulated data are removed periodically during the day, at the following intervals:
``` JSON
|                           | Calgary Test      | Prod (incl. Shanghai) |
|---------------------------|-------------------|-----------------------|
| Real APE Records          | ---               | Every 2 hours         |
| Simulated APE Records     | Every 12 hours    | Every 12 hours        |
| Simulated Gateway Records | Every 24 hours    | Every 24 hours        |
```
<br>
<br>

# Known Issues:

* You must insert some documents into the "activenodes" and "gatewayrecords" collections on your destination MongoDB server before starting the simulator. The schemas for these two collections are as follows:

#### Active Node:

```JSON
{
    curr_scenario:		Number,
    node_mac:			String,
    displayName: 		String,
    wireless_mode:		String,
    setup_id:			Number,
    channel_info:		Number,
    epoch_timestamp:	Date,
    last_update_time:	Date
}
```

Note: Insert one active node record for every node you want to simulate in the simulator program, as the simulator first queries this collection before beginning.

#### Gateway Record:

```JSON
{
    gw_mac:				String,
    name:		 		String,
    description:		String,
    curr_scenario:      Number,
    sensor_info:		{
        acc_mode:	Number,
        acc_x:      Number,
        acc_y:      Number,
        acc_z:      Number,
        mag_mode:   Number,
        mag_x:      Number,
        mag_y:      Number,
        mag_z:      Number,
        gyro_mode:  Number,
        gyro_x:     Number,
        gyro_y:     Number,
        gyro_z:     Number
    },
    resv_sensors:		[{
        sensor_type:	String,
        resv_mode:		Number,
        value:			Number,
        unit:			String
    }],
    date:				Date
}
```
Note: Be sure to insert one gateway record for every unique 'gw_mac' you want to simulate in the simulator program, as the simulator first does a "distinct" operation on the collection for the gw_mac field before inserting new records.
